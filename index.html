<!DOCTYPE html>
<html>
	<head>
		<!-- Title game is weak at the moment. -->
		<title>Simple Vote!</title>

		<!-- Determines the color of the address bar in Chrome mobile. -->
		<meta class="barcolor" id="chromebarcolor" name="theme-color" content=""/>

		<!-- No need to zoom into the colors. -->
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no"/>

		<!-- Minor styling to make it all flow together. -->
		<style>
			html {
				height: 100%;
				margin: 0;
				padding: 0;
			}

			body {
				background-color: black;
				height: 100%;
				margin: 0;
				padding: 0;
				width: 100%;
			}

			#candidates {
				border-collapse: collapse;
				height: 100%;
				width: 100%;
			}

			.candidate {
				box-shadow: 0px 0px 5px rgb(120, 120, 120);
				margin: 0;
				padding: 0;
			}
		</style>

		<!-- World Context -->
		<script>
			/**
			 * Context of the functions for the system.
			 */
			const ColoredVote = {};
		</script>

		<!-- RGBA Colors -->
		<script>
			/**
			 * The "null" color.
			 */
			const NULL_COLOR = "null";

			/**
			 * Colors as rgba values.
			 */
			const COLORS = {
				"pink": "rgba(255, 0, 255, 1)",
				"blue": "rgba(0, 145, 235, 1)",
				"orange": "rgba(255, 145, 0, 1)",
				"green": "rgba(0, 190, 0, 1)",
				"null": "rgba(0, 0, 0, 1)"
			};

			/**
			 * Uses the available COLORS to return the array of key values as colors
			 * sans NULL_COLOR.
			 */
			ColoredVote.getColors = function() {
				return Object.keys(COLORS).filter(c => c !== NULL_COLOR);
			};

			/**
			 * Uses the available COLORS to get a valid rgba string from a color name.
			 */
			ColoredVote.getRGBA = function(colorName) {
				return typeof COLORS[colorName] === "string" ? COLORS[colorName] : COLORS[NULL_COLOR];
			};
		</script>

		<!-- Candidate Installation -->
		<script>
			/**
			 * This function takes in a table from a DOM and returns an array
			 * of all cells in the table.
			 */
			ColoredVote.cellsIn = function(table) {
				const cells = [];
				const rows = table.rows;
				for (let i in rows) {
					const row = rows[i].cells !== undefined ? rows[i].cells : [];
					for (let j = 0; j < row.length; j++)
						cells.push(row[j]);
				}

				return cells;
			};

			/**
			 * This function takes all of the elements of some table and makes them a
			 * distinct color
			 */
			ColoredVote.colorizeCandidates = function(numCandidates, table) {
				const cells = ColoredVote.cellsIn(table);
				const colors = ColoredVote.getColors();
				const l = colors.length - 1;

				// Used to iterate through all available colors independent of the number of cells in each row.
				let h = 0;

				// Iterate through all of the rows and colorize them.
				for (let i = 0; i < cells.length; i++) {
					const cell = cells[i];

					cell.style.backgroundColor = ColoredVote.getRGBA(h > l ? NULL_COLOR : colors[h++]);
				}

				console.log("colorizeCandidates");
			};

			/**
			 * This function takes in the table DOM element and adds all of the desired
			 * candidates that will be displayed on the screen.
			 */
			ColoredVote.addAvailableCandidates = function(numCandidates, table) {
				// The total number of rows
				const nR = Math.ceil(Math.sqrt(numCandidates));

				// The number of candidates per row
				const cPR = Math.round(Math.sqrt(numCandidates));

				// First add the td cels into the table
				for (let i = 0; i < Math.ceil(numCandidates / cPR); i++) {
					const row = document.createElement("tr");

					for (let j = 0; j < cPR; j++) {
						if ((i + 1) * (j + 1) <= numCandidates) {
							const td = document.createElement("td");
							td.classList.add("candidate");
							row.appendChild(td);
						}

						// We have more table slots than candidates available
						else
							break;
					}

					table.appendChild(row);
				}

				// Then colorize them
				ColoredVote.colorizeCandidates(numCandidates, table);

				// Finally we make them all be displayed on the screen
				const candidates = document.getElementsByClassName("candidate");
				for (let i = 0; i < candidates.length; i++) {
					const p = (100 / cPR) + "%";
					candidates[i].style.width = p;
					candidates[i].style.height = p;
				}

				console.log("addAvailableCandidates");
			};
		</script>

		<!-- Animation Installation -->
		<script>
			/**
			 * Transforms p in [0, 1] to q in [0, 1] of different acceleration.
			 */
			ColoredVote.t = function(p) {
				return 0.5 * (1 - Math.cos(p * Math.PI));
			};

			/**
			 * This function fades in the available selection when the page is loaded
			 * for the first time.
			 */
			ColoredVote.fadeInCandidates = function(dur, table, callback) {
				// First make the table invisible
				table.style.opacity = 0;
				table.style.width = 0;
				table.style.height = 0;

				// Then fade it in over a set duration
				const START_TIME = Date.now();

				const ANIMATION = () => {
					let CURR_TIME = Date.now();

					if ((CURR_TIME - START_TIME) < dur) {
						const p = ColoredVote.t((CURR_TIME - START_TIME) / dur);

						table.style.opacity = p;
						table.style.width = (100 * p) + "%";
						table.style.height = (100 * p) + "%";

						id = requestAnimationFrame(ANIMATION);
					} else {
						table.style.opacity = 1;
						table.style.width = "100%";
						table.style.height = "100%";
						callback(table);
					}
				};

				requestAnimationFrame(ANIMATION);

				console.log("fadeInCandidates");
			};

			/**
			 * This function adds all of the fancy animations that will make the page
			 * feel more professional.
			 */
			ColoredVote.installClickAnimations = function(table) {

				console.log("installClickAnimations");
			};
		</script>

		<!-- Load Handlers and Initializations -->
		<script>
			/**
			 * This function handles everything that must happen once the DOM has
			 * finished loading.
			 */
			ColoredVote.loadHandler = function(e) {
				const NUM_CANDIDATES = 4;
				const FADE_IN_DUR_MS = 450;
				const table = document.getElementById("candidates");

				ColoredVote.addAvailableCandidates(NUM_CANDIDATES, table);
				ColoredVote.fadeInCandidates(FADE_IN_DUR_MS, table, ColoredVote.installClickAnimations);

				console.log("loadHandler");
			};

			/**
			 * This function starts the ColoredVote system on the browser.
			 */
			ColoredVote.start = function () {
				window.addEventListener("load", ColoredVote.loadHandler);

				console.log("start");
			};
		</script>

		<!-- Instantiation -->
		<script>ColoredVote.start();</script>
	</head>

	<body>
		<table id="candidates"></table>
	</body>
</html>
